function two_close(e){Remove_Class_half(),compare_init(e)}function compare_init(e){$(".toplist li").removeClass("choose");for(var t=0;t<$(".toplist li").length;t++)$(".toplist li").eq(t).val()==e&&$(".toplist li").eq(t).addClass("choose");Set_compare_header(1),Set_tapone(1),Set_taptwo(1)}function Set_Class_half(){$("#tap_one").addClass("half"),$("#tap_two").addClass("half"),$("#tap_three").addClass("half"),$("#tap_four").addClass("half"),$(".compare_header").addClass("half")}function Remove_Class_half(){$("#tap_one").removeClass("half"),$("#tap_two").removeClass("half"),$("#tap_three").removeClass("half"),$("#tap_four").removeClass("half"),$(".compare_header").removeClass("half")}function Get_compare_header(e){var t="",a="123";return t+='<div class="compare_header">',t+=null!=e&&""!=e?'<div class="close_btn"><a href="list.html" rel="external">X</a></div>':'<div class="close_btn"><a onclick="two_close('+a+');">X</a></div>',t+='<div class="compare_header_title">平安车险</div>',t+='<div class="compare_header_price">￥3574.56</div>',t+='<div class="compare_header_btn">',t+='<a href="#searhStep2" data-role="button" class="btn btn-squared">购买</a>',t+="</div>",t+='<div class="compare_header_star"></div>',t+="</div>"}function Set_compare_header(e){for(var t="",a=0;a<e;a++)t+=1==e?Get_compare_header(1):Get_compare_header();$("#compare_header_list").html(t)}function Get_tapone(e){var t="";return t+='<div class="li-control">',t+='<ul id="listview_tapone_'+e+'" data-role="listview" data-inset="true" data-shadow="false">',t+=Create_tapone_list_divider("车辆损失险"),t+=Create_tapone_li("269820（保额)","3956.21（保费）"),t+=Create_tapone_list_divider("第三者责任险"),t+=Create_tapone_li("50万（保额）","416.21（保费）",1),t+=Create_tapone_list_divider("全车盗抢险"),t+=Create_tapone_li("投保","1216.56（保费）"),t+=Create_tapone_list_divider("司机责任险"),t+=Create_tapone_li("1万（保额）","416.21（保费）",1),t+=Create_tapone_list_divider("交强险"),t+=Create_tapone_li("投保","850.00（保费）"),t+=Create_tapone_list_divider("车船税"),t+=Create_tapone_li("代缴","548.00（保费）"),t+="</ul>",t+="</div>"}function Set_tapone(e){for(var t="",a=0;a<e;a++)t+=Get_tapone(a);$("#tap_one").html(t);for(var a=0;a<e;a++)$("#listview_tapone_"+a).listview()}function Get_taptwo(e){var t="";return t+='<div class="li-control">',t+='<ul  id="listview_taptwo_'+e+'" data-role="listview" data-inset="true" data-divider-theme="a" data-shadow="false" data-icon="false">',t+=Create_taptwo_title("理赔特色服务"),t+=Create_taptwo_li("报案到赔款，3天到账",1),t+=Create_taptwo_li("结案支付，即时到账",1),t+=Create_taptwo_li("人伤案件，安心理赔",1),t+=Create_taptwo_li("上门代收理赔资料",1),t+=Create_taptwo_li("个人VIP客户简易理赔服务",1),t+=Create_taptwo_title("理赔流程"),t+=Create_taptwo_li("车损理赔流程",1),t+=Create_taptwo_li("车损快速赔款",1),t+=Create_taptwo_li("人伤理赔流程",1),t+=Create_taptwo_title("理赔网点"),t+=Create_taptwo_li("客户门店",1),t+="<li>",t+='<a href="#glist3" data-rel="popup" class="li-popup">客户门店<span class="text-small">广东广州地区共 <span class="text-red">16</span> 个网点</span></a>',t+="</li>",t+="<li>",t+='<a class="li-popup">合作修理厂<span class="text-small">广东 广州地区共 <span class="text-red">26</span> 个 <span class="text-red">奥迪</span> 修理厂</span></a>',t+="</li>",t+="</ul>",t+="</div>"}function Set_taptwo(e){for(var t="",a=0;a<e;a++)t+=Get_taptwo(a);$("#tap_two").html(t);for(var a=0;a<e;a++)$("#listview_taptwo_"+a).listview()}function Create_tapone_list_divider(e){var t="";return t+='<li data-role="list-divider" class="lihead">'+e+"</li>"}function Create_tapone_li(e,t,a){var i="";return i+="<li>",i+="<div>",i+="<p>"+e+"</p>",i+="</div>",i+="<div>",i+='<span class="text-green">'+t+"</span>",null!=a&&""!=a&&(i+='<span class="circle">低</span>'),i+="</div>",i+="</li>"}function Create_taptwo_title(e){var t="";return t+='<li data-role="list-divider" style="text-align: center">'+e+"</li>"}function Create_taptwo_li(e,t){var a="";return a+='<li><a href="#taptwo_popup_'+t+'" data-rel="popup" class="li-popup">'+e+'<span class="text-small">详细></span></a></li>'}var product_defaultid,product_chooseid;$(document).ready(function(){compare_init(123),product_defaultid=$(".toplist li.choose").eq(0).val(),$(".toplist li").click(function(){var e=$(".toplist li.choose").length;if($(this).hasClass("choose"))2==e&&($(this).removeClass("choose"),Remove_Class_half(),Set_compare_header(1),Set_tapone(1),Set_taptwo(1));else if(e<2){$(this).addClass("choose");$(this).val();Set_compare_header(2),Set_tapone(2),Set_taptwo(2),Set_Class_half()}})}),$(document).on("mobileinit",function(){$.mobile.defaultPageTransition="slide",$.ajaxSetup({headers:{"x-user-id":"qunabao"}})})(function(e){function t(e){var t=parseInt(1e5*Math.random());$(e.pageContainer).append('<div class="arpopup" id="pop_'+t+'"/>');var a=$("#pop_"+t),i='<div class="content">'+e.content+"</div>";i+="<footer>",e.buttons&&e.buttons.forEach(function(e,t){i+='<button class="'+e.class+'">'+e.text+"</button>",a.on("click.button",e.class,function(){return e.handle&&e.handle(a),!1})}),i+="</footer>",a.append(i).popup({transition:"fade",overlayTheme:"b",afterclose:e.afterClose,afteropen:function(){e.autoClose&&setTimeout(function(){a.popup("close")},e.autoClose),"function"===e.afterOpen&&e.afterOpen()}}).popup("open").on("click.close",".btn-close",function(){return a.popup("close"),!1})}function a(t){function a(e){var t='<div class="index-toolbar">',a='<ul class="cart-step-list">';$.each(e,function(e,i){t+='<a href="#'+e+'">'+e+"</a>",a+='<li data-index="'+e+'"><span>'+e+"</span>",i.forEach(function(e,t){a+='<a href="#" data-request="'+e+'">'+e+"</a>"}),a+="</li>"}),a+="</ul>",t+="</div>";var i='<section id="brandList" data-url="/" class="active"><h4>按拼音字母查找</h4>'+t+a+"</section>";return i}var i=$("#carModel"),n=i.parent();i.after('<div class="car-model" style="display:none;"/>');var s=$("#pop_searchCarModel"),o=($("#btn_searchCarModel"),"http://cx.baoxian.com/filter"),r="品牌,车系,排气量,年款,品牌型号与价格".split(",");s.popup({corners:!1,shadow:!1,positionTo:"window",tolerance:"0 0"}).on("popupbeforeposition",function(){$(this).closest(".ui-popup-container").css({width:$(e).width(),top:0,left:0}),$(this).find(".brand-content").css({height:$(e).height()-48})}).on("click",".index-toolbar a",function(){var e=$(this).attr("href").replace("#","");return $("#brandList").find("li[data-index="+e+"]")[0].scrollIntoView(),!1}).on("click",".toolbar h4 a",function(){var e=$(this),t=e.attr("data-step");if(0==t)return!1;var i=s.find("section"),n=i.filter(".active"),c=n.data("url"),l=c.replace(/\/[^\/]+?\/$/,"");e.attr("data-step",t-1).text(r[t-1]);var d=i.filter('[data-url="'+l+'/"]');return d.length>0?(n.removeClass("active"),d.addClass("active")):($.mobile.loading("show"),$.ajax({url:o+l,dataType:"jsonp"}).then(function(e){$.mobile.loading("hide");var i='<section data-url="'+l+'/" class="active">\n<ul class="cart-step-list">\n';if(1==t){var s=a(e);n.removeClass("active").after(s)}else e.forEach(function(e,t){var a=e,n=e;"object"==$.type(e)&&(e.id?(n=e.id,a="<p>"+e.standardName+"<span>"+e.remark+'</span></p><p class="price">￥'+e.taxPrice+"</p>"):(a=e.text,n=e.value)),i+='<li><a href="#" data-request="'+n+'">'+a+"</a></li>"}),i+="</ul>",i+="</section>",n.removeClass("active").after(i)})),!1}).on("click","a.btn-close",function(){return s.popup("close"),!1}).on("click","a[data-request]",function(){var e=$(this).data("request"),a=$(this).closest("section"),c=s.find("section"),l=s.find(".toolbar"),d=a.data("url"),p=d.split("/").length-2,u=l.data("step"),f=d+e,v=c.filter('[data-url="'+f+'/"]');return p==u?(i.val($(this).text()).hide().next(".car-model").html($(this).html()).show(),n.removeClass("field-error"),t.id=e,sessionStorage.setItem("selectedCarItem",e),sessionStorage.setItem("carItemUrl",d),s.popup("close"),!1):v[0]?(a.removeClass("active"),v.addClass("active"),l.find("h4 a").attr("data-step",p+1).text(r[p+1]),!1):($.mobile.loading("show"),$.ajax({url:o+f,dataType:"jsonp"}).then(function(e){$.mobile.loading("hide"),p==u-1&&(t.carItems=e,sessionStorage.setItem("carItems",JSON.stringify(e)));var i='<section data-url="'+f+'/" class="active">\n<ul class="cart-step-list">\n';e.forEach(function(e,t){var a=e,n=e;"object"==$.type(e)&&(e.id?(n=e.id,a="<p>"+e.standardName+"<span>"+e.remark+'</span></p><p class="price">￥'+e.taxPrice+"</p>"):(a=e.text,n=e.value)),i+='<li><a href="#" data-request="'+n+'">'+a+"</a></li>"}),i+="</ul>",i+="</section>",a.removeClass("active").after(i),l.find("h4 a").attr("data-step",p+1).text(r[p+1])}),!1)}),n.on("click",function(){var e=s.find("section");if(e[0]){e.length;return s.popup("open"),!1}return $.mobile.loading("show"),$.ajax({url:o,dataType:"jsonp",timeout:5e3}).then(function(e){$.mobile.loading("hide");var t='<div class="brand-content">',i='<div class="toolbar" data-step="'+(r.length-1)+'"><h4><a href="#" data-step="0">'+r[0]+'</a></h4><a href="#" class="btn-close"></a></div>';t+=a(e),t+="</div>",s.html(i+t),s.popup("open")},function(e,t,a){$.mobile.loading("hide"),s.popup("close")}),!1})}e.apiOrigin="http://119.29.120.204:5000",Date.prototype.format=function(e){null!=e&&""!=e||(e="y-m-d");var t=this.getFullYear(),a=this.getMonth()+1,i=this.getDate(),n=e.replace(/y+/gi,t);return n=n.replace(/m+/gi,(a<10?"0":"")+a),n=n.replace(/d+/gi,(i<10?"0":"")+i)};var i={};i.toUnicode=function(e){return escape(e).replace(/%/g,"\\")},i.popup=t,i.search={CarSelect:a},i.list={},i.sidebar={},i.compare={},e.globalPage=i})(window),$(function(){$(document).on("click",function(e){var t=$(e.target);if(t.hasClass("btn-close"))return t.closest(".ui-tips").hide(),!1}),$.fn.serializeJson=function(e){var t={};return $(this.serializeArray()).each(function(){e&&e(this.value)||(t[this.name]=this.value)}),t}}),$(document).on("click.fanhua",function(){$("#pop_fliter").hide()}).on("mobileinit",function(){}).on("pagebeforechange",function(){}).on("pagechange",function(){}).on("pagebeforeload",function(){}).on("pageload",function(){}).on("pagebeforecreate","#searchPage",function(){}).on("pagecreate","#searchPage",function(){function e(e,t){return $.ajax({url:e+t.latitude+","+t.longitude+"&output=json",dataType:"jsonp"}).then(function(e){i=e.result.addressComponent.city,a.after('<span class="current-add">'+i+"<small>(自动定位)</small></span>")}),i}var t={};globalPage.search.CarSelect(t);var a=$("#address").closest(".ui-input-text"),i="",n="",s="http://api.map.baidu.com/geocoder/v2/?ak=i7h7GCkoXrYtPmetBTq5I3dN&location=";if(!i){var o=function(e){switch(e.code){case e.TIMEOUT:console.log("A timeout occured! Please try again!");break;case e.POSITION_UNAVAILABLE:console.log("We can't detect your location. Sorry!");break;case e.PERMISSION_DENIED:console.log("Please allow geolocation access for this to work.");break;case e.UNKNOWN_ERROR:console.log("An unknown error occured!")}i="自动获取失败"},r=function(t){var a=t.coords;if(void 0!=t.address){var n=(t.address.country,t.address.region,t.address.city);i=n}else i=e(s,a)};navigator.geolocation?navigator.geolocation.getCurrentPosition(r,o,{enableHighAcuracy:!0,timeout:3e4,maximumAge:3e3}):(alert("Your browser does not support Geolocation!"),i="抱歉，您的浏览器不支持自动获取功能")}var c=$("#pop_cityList");c.popup("option",{corners:!1,shadow:!1,positionTo:"window",tolerance:"0 0"}).on("popupbeforeposition",function(e,t){$(this).closest(".ui-popup-container").css({width:$(window).width(),top:0,left:0}),$(this).find(".city-wrap").css({height:$(window).height()-48})}).on("click",".index-toolbar a",function(){var e=$(this).attr("href").replace("#","");return c.find("li[data-index="+e+"]")[0].scrollIntoView(),!1}).on("click","a.btn-close",function(){return c.popup("close"),!1}),$("#address").on("focus",function(){c.popup("open"),$.ajax({url:"../assets/region.json",type:"get",dataType:"json"}).then(function(e){function a(e){var a='<a href="#" data-id="'+e.id+'">'+e.name+"</a>",s=e.pinyin.charAt(0).toUpperCase();d[s]+=a,e.hot&&(o+='<a href="#" data-id="'+e.id+'">'+e.name.replace("市","")+"</a>"),i&&i==e.name&&(n=e.id,$("#address").attr("data-cityid",n),t.cityid=cityID)}if(!e.regions||!e.regions.length)return!1;var s='<section class="auto-city"><h4>自动定位</h4><ul><li><a href="#" data-id="'+n+'">'+i+"</a></li></ul></section>",o='<section class="hot-city"><h4>热门城市</h4><ul><li>',r='<section class="letter-city"><h4>按拼音字母查询</h4>',c='<div class="index-toolbar">',l="<ul>",d={};"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(function(e,t){d[e]=""}),e.regions.forEach(function(e,t){return e.municipality||e.special?void a(e):void(e.regions&&e.regions.length&&e.regions.forEach(function(e,t){a(e)}))}),$.each(d,function(e,t){return""==t||(c+='<a href="#'+e+'">'+e+"</a>",void(l+='<li data-index="'+e+'"><span>'+e+"</span>"+t+"</li>"))}),o+="</li></ul></section>",c+="</div>",l+="</ul>",r+=c+l+"</section>",$("#city_wrap").html((n?s:"")+o+r)})}),$("#city_wrap").on("click","a[data-id]",function(){var e=$(this).attr("data-id");return!!e&&($("#address").val($(this).text()).attr("data-cityid",e),t.cityid=e,a.removeClass("field-error").next(".current-add").remove(),c.popup("close"),!1)})}).on("pageinit","#searchPage",function(e,t){$("#btn_search").on("click",function(){var e=$("#address"),t=e.attr("data-cityid")||"440100",a=!0;return""!=e.val()&&t||(e.parent().addClass("field-error"),a=!1),""==$("#carModel").val()&&($("#carModel").parent().addClass("field-error"),a=!1),a?(t=t.substr(0,2)+"0000",sessionStorage.setItem("cityid",t),$($.mobile.pageContainer).pagecontainer("change","search_result.html",{changeHash:!1}),!1):void globalPage.popup({pageContainer:"#searchPage",content:"请先完善页面信息",buttons:[{class:"btn-close",text:"我知道了"}]})})}).on("pagebeforeshow","#searchPage",function(){}).on("pageshow","#searchPage",function(){}).on("pagebeforehide","#searchPage",function(){}).on("pagehide","#searchPage",function(){}).on("pagebeforecreate","#searchResultPage",function(e,t){}).on("pagebeforeshow","#searchResultPage",function(){}).on("pageshow","#searchResultPage",function(){var e=sessionStorage.getItem("cityid");$.ajax({url:apiOrigin+"/prv/q?region="+e,dataType:"json"}).then(function(e){if(!e||!e.length)return globalPage.popup({pageContainer:"#searchResultPage",content:"没有匹配的供应商",buttons:[{class:"btn-close",text:"我知道了"}],afterClose:function(){$.mobile.navigate("#searchPage")}}),!1;var t=$.Deferred();$("#allQty").countTo({to:30,speed:500}),$("#resultQty").text(e.length).countTo({to:e.length,onComplete:function(){$.when(t.promise()).done(function(){$($.mobile.pageContainer).pagecontainer("change","list.html")})}}),sessionStorage.setItem("providers",JSON.stringify(e));var a=apiOrigin+"/quote/mq";$.ajax({url:a,type:"post",data:{uid:"qunabao"}}).then(function(i){sessionStorage.setItem("mqid",i);var n=a+"/"+i,s=n+"/alter";$.ajax({url:s,type:"post",dataType:"json"}).then(function(a){var i=s+"/"+a.param,o=[];e.forEach(function(e,t){var a={buyWay:{idx:3,name:"地面销售"},pid:e.prvId,verInfo:e.verInfo,relateRule:e.products[0].relateRule,insComId:e.comId};o.push(a)});var r,c=JSON.parse(sessionStorage.getItem("carItems")),l=sessionStorage.getItem("selectedCarItem");c.forEach(function(e,t){e.id==l&&(r={taxPrice:e.taxPrice,displacement:e.displacement})});var d={city:sessionStorage.getItem("cityid"),province:sessionStorage.getItem("cityid")};$.when($.ajax({url:i+"/dealOffer/carInfo",type:"PUT",data:JSON.stringify(r)}),$.ajax({url:i+"/dealOffer/insArea",type:"PUT",data:JSON.stringify(d)})).done(function(e){$.ajax({url:i,type:"POST"}).done(function(e){var a=function(e){$.ajax({url:n+"/latest/vehicleEnquirys",type:"GET",dataType:"json"}).done(function(e){t.resolve();var a={};$.each(e,function(e,t){a[t]=e}),sessionStorage.setItem("providerToSqid",JSON.stringify(a))})},i=function(e){409==e.status&&s()},s=function(){$.ajax({url:n+"/action/submit",type:"POST"}).done(a).fail(i)};s()})})})})},function(e){})}).on("pagebeforehide","#searchResultPage",function(){}).on("pagehide","#searchResultPage",function(){}).on("pageinit","#listPage",function(){function e(e){if(!e||!e.length)return"";$(".result-status").find("b").text(n.length);var t="";return e.forEach(function(e,a){t+='<li class="loading'+(e.level?" recommend":"")+'" data-providerid="'+e.prvId+'">',t+='<a href="compare.html" rel="external">',t+=e.name,t+="</a>",t+='<div class="ui-li-aside">',t+='<span class="glyphicon glyphicon-refresh"></span>',t+='<span class="price"><span></span></span>',t+="</div>",t+="</li>"}),t}function t(e,a){$.ajax({url:e+"/latest",type:"GET",dataType:"json"}).done(function(e){var n=$("#providerList").find(">li[data-providerid="+e.providerId+"]");if(5==e.state.idx){var r=parseInt(e.misc.minDiscountPremium)+(e.misc.minDiscountPremium!=e.misc.discountPremium?"-<span>"+parseInt(e.misc.discountPremium)+"</span>":"");n.removeClass("loading").find(".price").html(r);var c=JSON.parse(sessionStorage.getItem("providerPrice"))||{};c[e.providerId]=r,sessionStorage.setItem("providerPrice",JSON.stringify(c))}else if(10==e.state.idx)n.removeClass("loading").addClass("no-result");else if(3==e.state.idx){var l=o+"/"+s[e.providerId];i[a]<=3?setTimeout(function(){t(l,a)},5e3):i[a]>3&&i[a]<6&&setTimeout(function(){t(l,a)},1e4),i[a]++}else if(4==e.state.idx)globalPage.popup({pageContainer:"#listPage",content:e.state.name,autoClose:2e3});else if(2==e.state.idx){var l=o+"/"+s[e.providerId];setTimeout(function(){t(l,a)},5e3)}})}$("#btn_closeInstruction").on("click",function(){$("#list_collapsible").css({opacity:0}).slideUp(300)});var a=$("#pop_fliter");$("#btn_filter").on("click",function(){return a.toggle(),!1}),$("#pop_fliter").on("click","li",function(){});var i={},n=JSON.parse(sessionStorage.getItem("providers")),s=JSON.parse(sessionStorage.getItem("providerToSqid")),o=apiOrigin+"/quote/sq";$("#providerList").html(e(n)).listview("refresh").on("click","li",function(e){var a=$(this);if(a.hasClass("loading")||a.hasClass("no-result"))return!1;var i=$(this).attr("data-providerid"),n=JSON.parse(sessionStorage.getItem("providerToSqid"))[i],s=o+"/"+n;return $(e.target).is(".glyphicon-refresh")?(a.addClass("loading"),t(s,n),!1):void sessionStorage.setItem("selectedProvider",i)}),s&&$.each(s,function(e,a){var n=o+"/"+a;i[a]=1,t(n,a)});var r=sessionStorage.offerProgress;r=r<34?1:r<100?2:3,$(".accuracy1").addClass("accuracy"+r)}).on("pagecreate","#sidebarPage",function(){function e(e){var t="";return"select"==e.type?(t+='<select name="'+e.name+'">',e.option.forEach(function(e,a){t+='<option value="'+e.value+'"'+(e.selected?"selected":"")+">"+e.text+"</option>"}),t+="</select>"):t+='<input type="'+e.type+'" name="'+e.name+'" placeholder="'+e.placeholder+'" />',t}var t=JSON.parse(sessionStorage.getItem("providers")),a="";t&&(t.forEach(function(e,t){a+='<option value="'+e.comId+'">'+e.name+"</option>"}),$("#lastComCode,#lastComCode2").append(a)),$("#firstRegDate").val((new Date).format("y-m-d")),$("#effectiveDate").val(new Date(Date.parse(new Date)+864e5).format("y-m-d"));var i=[{name:"birthday",type:"date",text:"出生日期",placeholder:"年/月/日"},{name:"gender",type:"select",text:"性别",option:[{text:"男",value:"1:male",selected:!0},{text:"女",value:"2:female"}]},{name:"drivingLicenceType",type:"select",text:"驾照类型",option:[{text:"A",value:"1"},{text:"B",value:"2"},{text:"C",value:"3"},{text:"D",value:"4"},{text:"E",value:"5"},{text:"F",value:"6"},{text:"H",value:"7"},{text:"K",value:"8"},{text:"J",value:"9"},{text:"M",value:"10"},{text:"N",value:"11"},{text:"P",value:"12"},{text:"Q",value:"13"},{text:"A1",value:"14"},{text:"A2",value:"15"},{text:"A3",value:"16"},{text:"B1",value:"17"},{text:"B2",value:"18"},{text:"C1",value:"19",selected:!0},{text:"C2",value:"20"},{text:"C3",value:"21"},{text:"C4",value:"22"}]},{name:"licensedDate",type:"date",text:"发证日期",placeholder:"年/月/日"}],n=$("#driverList"),s=n.find(">ul"),o='<li><h4>驾驶人<span>(1)</span><a href="#" class="btn-remove glyphicon glyphicon-trash" title="删除驾驶人"></a></h4>\n<form>\n';i.forEach(function(t,a){o+='<div class="ui-field-contain">\n<label for="'+t.name+'">'+t.text+"</label>\n"+e(t)+"\n</div>"}),o+="</form>\n</li>",$("#isSpecifyDriver1").on("click",function(){n.show(),""==s.html()&&(s.append(o),s.find("select").selectmenu(),s.find("input").textinput())}),$("#isSpecifyDriver2").on("click",function(){n.hide()}),n.on("click","#btn_addDriver",function(){var e=s.find(">li").length;if(e>=3)return globalPage.popup({pageContainer:"#sidebarPage",content:"最多只能添加3个驾驶人",autoClose:"2000"}),!1;s.append(o);var t=s.find(">li").eq(e);t.find("h4 > span").text("("+(e+1)+")"),t.find("select").selectmenu(),t.find("input").textinput()}).on("click",".btn-remove",function(){return $(this).closest("li").remove(),!1})}).on("pageinit","#sidebarPage",function(){function e(e){s.find("a").text(e==i-1?"刷新价格":"下一步"),n.removeClass("checked").eq(e).addClass("checked")}function t(e){if(!r[e])return"";var t='<div class="insurance-desc" id="desc_'+e+'">\n<div class="rec"></div>\n<header>\n<span class="nun">'+r[e].rate+'%</span>购买率\n</header>\n<div class="content">\n<div class="title">'+r[e].title+'</div>\n<div class="desc">'+r[e].description+'</div>\n<h4>典型案例</h4>\n<div class="gallery">\n<ul class="slider">\n';return r[e].cases.forEach(function(e,a){t+='<li><img src="'+e.img+'" /><p class="title">'+e.title+"</p></li>"}),t+='</ul>\n<div class="glyphicon glyphicon-menu-left"></div><div class="glyphicon glyphicon-menu-right"></div>\n</div></div></div>'}var a=$("#js_sidebar_head_tabs > li"),i=a.length,n=$(".steps-wrap li"),s=($(".progress-bar > .bar"),$(".btn-next"));s.bind("click",function(){function t(){var e,t=JSON.parse(sessionStorage.getItem("carItems")),a=sessionStorage.getItem("selectedCarItem");return t.forEach(function(t,i){t.id==a&&(e={firstRegDate:$("#firstRegDate").val(),isTransferCar:!!$("input[type=radio]:checked").val(),taxPrice:t.taxPrice,displacement:t.displacement})}),e.firstRegDate||delete e.firstRegDate,e}function n(){var e={baseGuard:{ThirdPartyIns:{amount:3e5,ecode:"ThirdPartyIns",selIdx:1},NcfThirdPartyIns:{amount:-1,ecode:"NcfThirdPartyIns",selIdx:1},VehicleCompulsoryIns:{amount:-1,ecode:"VehicleCompulsoryIns",selIdx:1}},hightGuard:{VehicleDemageIns:{amount:-1,ecode:"VehicleDemageIns",selIdx:1},ThirdPartyIns:{amount:5e5,ecode:"ThirdPartyIns",selIdx:6},TheftIns:{amount:-1,ecode:"TheftIns",selIdx:1},DriverIns:{amount:1e4,ecode:"DriverIns",selIdx:2},PassengerIns:{amount:1e4,ecode:"PassengerIns",selIdx:2},GlassIns:{amount:-1,ecode:"GlassIns",selIdx:1},VehicleCompulsoryIns:{amount:-1,ecode:"VehicleCompulsoryIns",selIdx:1},NcfVehicleDemageIns:{amount:-1,ecode:"NcfVehicleDemageIns",selIdx:1},NcfThirdPartyIns:{amount:-1,ecode:"NcfThirdPartyIns",selIdx:1},NcfTheftIns:{amount:-1,ecode:"NcfTheftIns",selIdx:1},NcfDriverIns:{amount:-1,ecode:"NcfDriverIns",selIdx:1},NcfPassengerIns:{amount:-1,ecode:"NcfPassengerIns",selIdx:1}},fullGuard:{VehicleDemageIns:{amount:-1,ecode:"VehicleDemageIns",selIdx:1},ThirdPartyIns:{amount:1e6,ecode:"ThirdPartyIns",selIdx:7},TheftIns:{amount:-1,ecode:"TheftIns",selIdx:1},DriverIns:{amount:1e4,ecode:"DriverIns",selIdx:2},PassengerIns:{amount:1e4,ecode:"PassengerIns",selIdx:2},GlassIns:{amount:-1,ecode:"GlassIns",selIdx:1},CombustionIns:{amount:-1,ecode:"CombustionIns",selIdx:1},ScratchIns:{amount:5e3,ecode:"ScratchIns",selIdx:2},WadingIns:{amount:-1,ecode:"WadingIns",selIdx:1},SpecifyingPlantCla:{amount:-1,ecode:"SpecifyingPlantCla",selIdx:1},VehicleCompulsoryIns:{amount:-1,ecode:"VehicleCompulsoryIns",selIdx:1},NcfVehicleDemageIns:{amount:-1,ecode:"NcfVehicleDemageIns",selIdx:1},NcfThirdPartyIns:{amount:-1,ecode:"NcfThirdPartyIns",selIdx:1},NcfTheftIns:{amount:-1,ecode:"NcfTheftIns",selIdx:1},NcfDriverIns:{amount:-1,ecode:"NcfDriverIns",selIdx:1},NcfPassengerIns:{amount:-1,ecode:"NcfPassengerIns",selIdx:1},NcfCombustionIns:{amount:-1,ecode:"NcfCombustionIns",selIdx:1},NcfScratchIns:{amount:-1,ecode:"NcfScratchIns",selIdx:1},NcfWadingIns:{amount:-1,ecode:"NcfWadingIns",selIdx:1}},customerGuard:{item:{}}},t=$(".project-list a[class*=ui-icon-check]",$("#sidebarPage")).closest("div[data-guard]").data("guard");if(t){if("customerGuard"===t){var a,i=$("#customerInsurance").serializeJson();for(var n in i)"VehicleDemageInsAmount"!==n&&"VehicleDemageIns"!==n?/:/.test(i[n])?0==/:-1$/.test(i[n])&&(a=i[n].split(":"),e.customerGuard[n]={amount:a[1],ecode:n,selIdx:a[0]}):e.customerGuard[n]={amount:"on"===i[n]?-1:i[n],ecode:n,selIdx:1}:"VehicleDemageIns"===n&&(a=i[n].split(":"),e.customerGuard.item[n]={amount:"1"===a[0]?i.VehicleDemageInsAmount||-1:-1,ecode:n,selIdx:a[0]})}return e[t]}console.error("获取选中的保险选项失败.")}function s(e){function t(){var t=$.Deferred(),a=$("#effectiveDate").val();if(!a){var i=new Date;a=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+(i.getDate()+1)}return a+=" 00:00:00.000",$.when($.ajax({url:e+"/bizEffectiveDate",type:"PUT",data:'"'+a+'"'}),$.ajax({url:e+"/efcEffectiveDate",type:"PUT",data:'"'+a+'"'})).done(function(e){t.resolve()}),t.promise()}function a(){var t=$.Deferred(),a=$("#lastComCode").val();return $.ajax({url:e+"/lastComCode",type:"PUT",data:'"'+a+'"',success:function(){t.resolve()}}),t.promise()}function i(){var t=$.Deferred(),a=$("#bizClaimsCount").val();return $.ajax({url:e+"/bizClaimsCount",type:"PUT",data:a,success:function(){t.resolve()}}),t.promise()}function n(){var t=$.Deferred(),a=$("#efcClaimsCount").val();return $.ajax({url:e+"/efcClaimsCount",type:"PUT",data:a,success:function(){t.resolve()}}),t.promise()}function s(){var t=$.Deferred();if($("#isSpecifyDriver1")[0].checked){var a=[],i=(new Date).getFullYear();$("#driverList").find("ul>li").each(function(){var e=$(this),t=e.find("input[name=licensedDate]").val(),n=e.find("select[name=drivingLicenceType]"),s=e.find("select[name=gender]").val().split(":"),o={birthday:e.find("input[name=birthday]").val(),drivingLicenceType:{idx:n.val(),name:n.find("option:selected").text()},drivingAge:i-new Date(t).getFullYear(),licensedDate:t,gender:{idx:s[0],name:s[1]}};a.push(o)}),$.ajax({url:e+"/drivers",type:"PUT",data:JSON.stringify(a),success:function(){t.resolve()}})}else t.resolve();return t.promise()}var o=$.Deferred();return $.when(t(),a(),i(),n(),s()).done(function(){o.resolve()}),o.promise()}var o=a.filter(".ui-tabs-active"),r=o.prevAll("li").length;if(r==i-1){var c=apiOrigin+"/quote/mq",l=sessionStorage.getItem("mqid"),d=c+"/"+l,p=d+"/alter",u=t(),f=n();return $.ajax({url:p,type:"post",dataType:"json"}).then(function(e){var t=p+"/"+e.param,a=t+"/dealOffer";$.when($.ajax({url:a+"/carInfo",type:"PUT",data:JSON.stringify(u)}),$.ajax({url:a+"/suite/items",type:"PUT",data:JSON.stringify(f)}),s(a)).done(function(t){$.ajax({url:d+"/alter/"+e.param,type:"POST"}).done(function(e){var t=function(e){$.ajax({url:d+"/latest/vehicleEnquirys",type:"GET",dataType:"json"}).done(function(e){var t={};$.each(e,function(e,a){t[a]=e}),sessionStorage.setItem("providerToSqid",JSON.stringify(t)),$($.mobile.pageContainer).pagecontainer("change","list.html")})},a=function(e){409==e.status&&i()},i=function(){$.ajax({url:d+"/action/submit",type:"POST"}).done(t).fail(a)};i()})})}),!1}return a.eq(r+1).find("a").click(),e(r+1),!1}),a.bind("click",function(){var t=$(this).prevAll("li").length;return e(t),!1}),n.bind("click",function(){var t=$(this).prevAll("li").length;return a.eq(t).find("a").click(),e(t),!1}),$("#searhStep1").find("footer a").bind("click",function(){this.href;return $("#searhStep1").hide(),$("#searhStep2").show(),!1});var o=$("#pop_customProject");o.popup("option",{corners:!1,shadow:!1,positionTo:"window",tolerance:"0 0"}).on("popupbeforeposition",function(e,t){$(this).closest(".ui-popup-container").css({width:$(window).width(),top:0,left:0}),$(this).find(".custom-content").css({height:$(window).height()-48})}).on("click",".btn-close",function(){return o.popup("close"),!1}),$(".btn-custom-set").on("click",function(){return o.popup("open"),!1}),$("#customProject .ui-collapsible-heading .ui-btn").on("click",function(){o.popup("open")});var r={VehicleDemageIns:{rate:95,title:"一种发生保险事故时，赔偿自己车辆损失的险种。",description:"所有车主。特别是3年以内新车、新手或者女性车主、中高级车辆。",cases:[{img:"../images/cases/u45_normal.png",title:"车主撞到停车场墙柱"},{img:"../images/cases/u4_normal.png",title:"车辆被刮蹭找不到肇事者"},{img:"../images/cases/u6_normal.png",title:"被大风吹倒的树木砸中"},{img:"../images/cases/u8_normal.png",title:"撞到别人的车"}]},ThirdPartyIns:{rate:99,title:"赔偿他人财产和人身伤亡的险种。",description:"所有车主。撞到豪车伤不起，撞到人更是可能赔个全家荡产，必买险种。",cases:[{img:"../images/cases/u2_normal.png",title:"撞到别人的车"},{img:"../images/cases/u10_normal.png",title:"撞到行人"}]},TheftIns:{rate:40,title:"赔偿全车被盗、被抢后造成的全车或者部分损失。",description:"无固定车库，一般停在露天停车场<br>经常在外出差，无固定停车地点<br>车辆停放区域治安不好",cases:[{img:"../images/cases/u12_normal.png",title:"停驶在室外被盗"},{img:"../images/cases/u25_normal.png",title:"夜间行车被抢劫"}]},DriverIns:{rate:72,title:"赔偿本车驾驶员伤亡费用的险种。",description:"新手，经常开车或者经常借车给别人开，建议购买。",cases:[{img:"../images/cases/u14_normal.png",title:"下雨车辆侧翻，司机被划伤"},{img:"../images/cases/u16_normal.png",title:"严重撞车造成司机死亡"}]},PassengerIns:{rate:63,title:"赔偿本车乘客（非驾驶员）伤亡费用的险种。",description:"经常开车带上家人或朋友，希望家人朋友的人身安全得到有效保障，建议购买。",cases:[{img:"../images/cases/u18_normal.png",title:"捎朋友回家，出事，朋友受伤"},{img:"../images/cases/u47_normal.png",title:"带家人出游出事，家人被划伤"}]},GlassIns:{rate:41,title:"赔偿挡风玻璃和车窗单独破碎的损失。（不含车灯车镜）<br>注：车损险是不保玻璃、车窗单独破碎的损失的。",description:"经常走高速公路<br>经常停在露天停车场<br>车辆停放区域治安不好<br>",cases:[{img:"../images/cases/u31_normal.png",title:"高速路上被飞石击碎车窗"},{img:"../images/cases/u33_normal.png",title:"被高空坠物砸坏挡风玻璃"}]},CombustionIns:{rate:30,title:"赔偿因本车自身原因起火造成的损失。",description:"适合车主：<br>车辆使用超过3年或者行驶超过3万公里，或夏季高温地区，推荐购买。",cases:[{img:"../images/cases/u35_normal.png",title:"10年老车，线路老化起火"},{img:"../images/cases/u37_normal.png",title:"高温地区，在停放时自燃"}]},ScratchIns:{rate:10,title:"负责赔偿无碰撞痕迹的车身表面油漆单独划伤。<br>注：有碰撞痕迹属车损险赔偿范围。",description:"适用于新车及新手。<br>注：细小的划痕通常可以通过美容进行处理。<br>若进行索赔可能会对第二年的保费产生影响，建议酌情购买。",cases:[{img:"../images/cases/u39_normal.png",title:"停在室外，被人恶意用小刀或螺丝钉划伤车身。"}]},WadingIns:{rate:"",title:"又名发动机损失险，因遭水淹或因涉水行驶造成发动机损坏的赔偿。",description:"经常暴雨、内涝，以及城市排水不好的地区，强烈推荐购买。",cases:[{img:"../images/cases/u41_normal.png",title:"夏季暴雨，停车场被淹，车辆被泡水。"},{img:"../images/cases/u43_normal.png",title:"从积水的道路上行驶，发动机进水熄火。"}]}};$("#pop_customProject .glyphicon-question-sign").on("click",function(){var e=$(this).closest(".ui-field-contain"),a=e.find(">label").attr("for");if(!r[a])return!1;if(e.next().is(".insurance-desc"))e.next(".insurance-desc").slideToggle();else{e.after(t(a));var i=$("#desc_"+a),n=Swipe(i.find(".gallery")[0],{});i.on("click",".glyphicon-menu-left",n.prev).on("click",".glyphicon-menu-right",n.next)}return!1}),$("#VehicleDemageIns").bind("change",function(){var e=$(this);"1:-1"===e.val()?$("#VehicleDemageInsAmount").prop("disabled",!1):$("#VehicleDemageInsAmount").prop("disabled",!0).val("")}).triggerHandler("change")}).on("pageshow","#sidebarPage",function(){function e(){function e(){var e=0,t={carModel:10,firstRegDate:15,effectiveDate:5,lastComCode:10,bizClaimsCount:15,efcClaimsCount:15};for(var a in t)$("#"+a).val()&&(e+=t[a]);var i={isTransferCar:10,isSpecifyDriver:5};for(var a in i)void 0!=$(":radio[name='"+a+"']:checked").val()&&(e+=i[a]);e+=$("#cardGuaranteeTab").has(".ui-icon-check")[0]?10:0,e+=5,sessionStorage.offerProgress=e,$(".progress-bar > .bar").css("width",e+"%").next().find("span").text(e)}$(".cardunder").bind("change",function(t){e()}),document.getElementById("cardGuaranteeTab").addEventListener("click",function(t){$(t.target).closest("h5.ui-collapsible-heading")[0]&&setTimeout(e,1)},!0),e()}var t={};globalPage.search.CarSelect(t);var a='<div class="toolbar" data-step="4"><h4><a href="#" data-step="4">车系</a></h4><a href="#" class="btn-close"></a></div>',i=sessionStorage.getItem("carItemUrl"),n=JSON.parse(sessionStorage.getItem("carItems")),s=sessionStorage.getItem("selectedCarItem"),o=$("#carModel"),r='<div class="brand-content"><section data-url="'+i+'" class="active" ><ul class="cart-step-list">';n.forEach(function(e){r+='<li><a href="#" data-request="'+e.id+'"><p>'+e.standardName+"<span>"+e.remark+'</span></p><p class="price">￥'+e.price+"</p></a></li>",e.id==s&&o.val(e.id).hide().next(".car-model").html("<p>"+e.standardName+"<span>"+e.remark+'</span></p><p class="price">￥'+e.price+"</p>").show()}),r+="</ul></section></div>",$("#pop_searchCarModel").html(a+r),$("#effectiveDate").val(new Date(Date.now()+864e5).format("y-m-d")),
e()}),$(document).on("pageinit","#comparePage",function(){function e(e,t){var a=html_first=_temp="";for(providerid in e)$.each(m,function(e,i){return _temp='<li data-prvid="'+i.prvId+'" class="swiper-slide">'+i.name+'<a class="comparebtn"></a></li>',t==i.prvId?(html_first=_temp,!0):providerid==i.prvId?(a+=_temp,!1):void 0});$(".toplist").html(html_first+a)}function t(e){n(),e==C?(C=w,a(w)):e==w&&a(C)}function a(e){$(".toplist li").removeClass("choose");for(var t=0;t<$(".toplist li").length;t++)$(".toplist li").eq(t).data("prvid")==e&&$(".toplist li").eq(t).addClass("choose");o(1),c(1),d(1),f(1)}function i(){$("#tap_one").addClass("half"),$("#tap_two").addClass("half"),$("#tap_three").addClass("half"),$(".compare_header").addClass("half")}function n(){$("#tap_one").removeClass("half"),$("#tap_two").removeClass("half"),$("#tap_three").removeClass("half"),$(".compare_header").removeClass("half")}function s(e){var t="";if(t+='<div class="compare_header">',null==e||""==e){t+='<a class="close_btn ui-btn ui-corner-all ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right" href="list.html" rel="external"></a>';for(var a in m)C==m[a].prvId&&(t+='<div class="compare_header_title">'+m[a].name+"</div>",t+='<div class="compare_header_price">￥'+I[_]+"</div>",t+='<div class="compare_header_btn">',t+='<a href="#" data-role="button" class="btn-buy">购买</a>',t+="</div>",t+='<div class="compare_header_star"></div>',t+="</div>")}else if(1==e){t+='<a class="close_btn ui-btn ui-corner-all ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right two_close_btn" id='+C+' "></a>';for(var a in m)C==m[a].prvId&&(t+='<div class="compare_header_title">'+m[a].name+"</div>",t+='<div class="compare_header_price">￥'+I[m[a].prvId]+"</div>",t+='<div class="compare_header_btn">',t+='<a href="#" data-role="button" class="btn-buy">购买</a>',t+="</div>",t+='<div class="compare_header_star"></div>',t+="</div>")}else if(2==e){t+='<a class="close_btn ui-btn ui-corner-all ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right two_close_btn" id='+w+' "></a>';for(var a in m)w==m[a].prvId&&(t+='<div class="compare_header_title">'+m[a].name+"</div>",t+='<div class="compare_header_price">￥'+I[m[a].prvId]+"</div>",t+='<div class="compare_header_btn">',t+='<a href="#" data-role="button" class="btn-buy">购买</a>',t+="</div>",t+='<div class="compare_header_star"></div>',t+="</div>")}return t}function o(e){for(var a="",i=0;i<e;i++)a+=1==e?s():s(i+1);$("#compare_header_list").html(a),$(".btn-buy").button({corners:!1,inline:!0,shadow:!1}),$(".two_close_btn").click(function(){t($(this).attr("id"))}),$(".compare_header_btn .btn-buy").click(function(){return!1})}function r(e){var t="";if(t+='<div class="li-control">',t+='<ul id="listview_tapone" data-role="listview" data-inset="true" data-shadow="false">',1!=e){for(var a,i,n=new Array,s=0;s<y.length;s++)C==y[s].providerId&&(a=s),w==y[s].providerId&&(i=s);var o=y[a].dealOffer.suite.items,r=y[i].dealOffer.suite.items;for(var c in o)for(var l in h.items)if(c==l){t+='<p class="ui-body lihead">'+h.items[l].caption+"</p>",t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+="-1"==o[c].amount?"<p>投保</p>":"<p>"+o[c].amount+"（保额）</p>",t+="</div>";for(var s in r)o[c].ecode==r[s].ecode&&(n.push(r[s].ecode),t+="<div>",t+="-1"==r[s].amount?"<p>投保</p>":"<p>"+r[s].amount+"（保额）</p>",t+="</div>");t+="</div>"}for(var s in r){var d=0;for(var c in n)n[c]==r[s].ecode&&d++;if(0==d){for(var p in h.items)p==s&&(t+='<p class="ui-body lihead">'+h.items[s].caption+"</p>");t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+="<p></p>",t+="<p></p>",t+="</div>",t+="<div>","-1"==r[s].amount?t+="<p>投保</p>":sstr+="<p>"+r[s].amount+"（保额）</p>",t+="<p></p>",t+="</div>",t+="</div>"}}}else for(var s=0;s<y.length;s++)if(C==y[s].providerId){var o=y[s].dealOffer.suite.items;for(var c in y[s].dealOffer.suite.items)for(var l in h.items)c==l&&(t+='<p class="ui-body lihead">'+h.items[l].caption+"</p>",t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+="-1"==o[c].amount?"<p>投保</p>":"<p>"+o[c].amount+"（保额）</p>",t+="</div>",t+="</div>")}return t+="</ul>",t+="</div>"}function c(e){$("#tap_one").html(r(e))}function l(e){var t="";if(t+='<div class="li-control">',t+='<ul id="listview_taptwo" data-role="listview" data-inset="true" data-shadow="false">',1!=e){for(var a,i,n=new Array,s=0;s<m.length;s++)C==m[s].prvId&&(a=s),w==m[s].prvId&&(i=s);$.each(m[a].products,function(e,s){$.each(s.servicesList,function(e,o){t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+='<p><a data-prvid="'+m[a].prvId+'" data-productscode="'+s.code+'" data-servicecode="'+o.title+'" class="servicespopup" data-role="button" href="#servicespopup">'+o.title+"</a></p>",t+="</div>",$.each(m[i].products,function(e,a){$.each(a.servicesList,function(e,s){o.title==s.title&&(n.push(s.title),t+="<div>",t+='<p><a data-prvid="'+m[i].prvId+'" data-productscode="'+a.code+'" data-servicecode="'+s.title+'" class="servicespopup" data-role="button" href="#servicespopup">'+s.title+"</a></p>",t+="</div>")})}),t+="</div>"})}),$.each(m[i].products,function(e,a){$.each(a.servicesList,function(e,s){var o=0;for(var r in n)n[r]==s.title&&o++;0==o&&(t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+="<p></p>",t+="</div>",t+="<div>",t+='<p><a data-prvid="'+m[i].prvId+'" data-productscode="'+a.code+'" data-servicecode="'+s.title+'" class="servicespopup" data-role="button" href="#servicespopup">'+s.title+"</a></p>",t+="</div>",t+="</div>")})})}else for(var s=0;s<m.length;s++)C==m[s].prvId&&$.each(m[s].products,function(e,a){$.each(a.servicesList,function(e,i){t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+='<p><a data-prvid="'+m[s].prvId+'" data-productscode="'+a.code+'" data-servicecode="'+i.title+'" class="servicespopup" data-role="button" href="#servicespopup">'+i.title+"</a></p>",t+="</div>",t+="</div>"})});return t+="</ul>",t+="</div>"}function d(e){$("#tap_two").html(l(e)),p()}function p(){$(".servicespopup").click(function(){var e=$(this).data("prvid"),t=$(this).data("productscode"),a=$(this).data("servicecode");return $.each(m,function(i,n){n.prvId==e&&$.each(n.products,function(e,i){i.code==t&&$.each(i.servicesList,function(e,t){if(t.title==a){$("#servicespopup_title").text(t.title);var i="";$.each(t.serviceInfoList,function(e,t){i+="<h4>"+t.title+"</h4>",i+="<p>"+t.detail+"</p>"}),$("#servicespopup .content").html(i)}})})}),$("#servicespopup").popup("open"),!1})}function u(e){var t="";if(t+='<div class="li-control">',t+='<ul id="listview_tapthree" data-role="listview" data-inset="true" data-shadow="false">',1!=e){for(var a,i,n=new Array,s=0;s<m.length;s++)C==m[s].prvId&&(a=s),w==m[s].prvId&&(i=s);$.each(m[a].products,function(e,s){$.each(s.gifts,function(e,o){t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+='<p><a data-giftsindex="'+e+'" data-prvid="'+m[a].prvId+'" data-productscode="'+s.code+'" data-giftscode="'+o.code+'" class="giftspopup" data-role="button" href="#giftspopup">'+(o.title?o.title:"")+"</a></p>",t+="</div>",$.each(m[i].products,function(e,a){$.each(a.gifts,function(e,s){o.code==s.code&&(n.push(s.code),t+="<div>",t+='<p><a data-giftsindex="'+e+'" data-prvid="'+m[i].prvId+'" data-productscode="'+a.code+'" data-giftscode="'+s.code+'" class="giftspopup" data-role="button" href="#giftspopup">'+(s.title?s.title:"")+"</a></p>",t+="</div>")})}),t+="</div>"})}),$.each(m[i].products,function(e,a){$.each(a.gifts,function(e,s){var o=0;for(var r in n)n[r]==s.code&&o++;0==o&&(t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+="<p></p>",t+="</div>",t+="<div>",t+='<p><a data-giftsindex="'+e+'" data-prvid="'+m[i].prvId+'" data-productscode="'+a.code+'" data-giftcode="'+s.code+'" class="giftspopup" data-role="button" href="#giftspopup">'+(s.title?s.title:"")+"</a></p>",t+="</div>",t+="</div>")})})}else for(var s=0;s<m.length;s++)C==m[s].prvId&&$.each(m[s].products,function(e,a){$.each(a.gifts,function(e,i){t+='<div class="ui-body ui-body-a ui-corner-all text-center liitem">',t+="<div>",t+='<p><a  data-giftsindex="'+s+'" data-prvid="'+m[s].prvId+'" data-productscode="'+a.code+'" data-giftcode="'+i.code+'" class="giftspopup" data-role="button" href="#giftspopup">'+(i.title?i.title:"")+"</a></p>",t+="</div>",t+="</div>"})});return t+="</ul>",t+="</div>"}function f(e){$("#tap_three").html(u(e)),v()}function v(){$(".giftspopup").click(function(){var e=$(this).data("prvid"),t=$(this).data("productscode"),a=$(this).data("giftsindex");return $.each(m,function(i,n){n.prvId==e&&$.each(n.products,function(e,i){i.code==t&&$.each(i.gifts,function(e,t){if(a==e){$("#giftspopup_title").text(t.title);var i="";i+="<h4>"+t.title+"</h4>",i+="<p>"+t.detail+"</p>",$("#giftspopup .content").html(i)}})})}),$("#giftspopup").popup("open"),!1})}var h,m=JSON.parse(sessionStorage.getItem("providers")),g=JSON.parse(sessionStorage.getItem("providerToSqid")),_=sessionStorage.getItem("selectedProvider"),I=JSON.parse(sessionStorage.getItem("providerPrice")),b=sessionStorage.getItem("cityid");e(I,_);new Swiper(".swiper-container",{slidesPerView:"auto",touchRatio:.3,freeMode:!0,spaceBetween:20});$.ajax({url:apiOrigin+"/prv/suite/"+b,async:!1,type:"get",dataType:"json",success:function(e){h=e}});var y=[];for(var x in g)$.ajax({url:apiOrigin+"/quote/sq/"+g[x]+"/latest",async:!1,type:"get",dataType:"json",success:function(e){y.push(e)}});var C,w;C=_,a(C),$("#searhStep1").find("footer a").bind("click",function(){this.href;return $("#searhStep1").hide(),$("#searhStep2").show(),!1}),$("#searhStep2").find("footer a").bind("click",function(){this.href;return $("#searhStep2").hide(),$("#searhStep3").show(),!1}),$("#searhStep3").find("footer a").bind("click",function(){this.href;return $("#searhStep3").hide(),$("#searhStep4").show(),!1}),$(".toplist").on("click",">li",function(){var e=$(".toplist li.choose").length;$(this).hasClass("choose")?2==e&&(C==$(this).data("prvid")&&(C=w),$(this).removeClass("choose"),n(),o(1),c(1),d(1),f(1)):e<2&&($(this).addClass("choose"),w=$(this).data("prvid"),o(2),c(2),d(2),f(2),i())}),$(function(){$(".compare_header_btn .btn").click(function(){return $("#popSearch").popup("open"),!1}),p(),v()})});